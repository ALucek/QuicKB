# =====================================================
# Full Pipeline Configuration
# =====================================================
pipeline:
  from_stage: "CHUNK"    # Options: CHUNK, GENERATE, TRAIN, UPLOAD
  to_stage: "UPLOAD"

path_to_knowledgebase: "./testing/knowledgebase"
chunker: "RecursiveTokenChunker" 
chunker_arguments:
  chunk_size: 400
  chunk_overlap: 0
  separators: ["\n\n", "\n", ".", "?", "!", " ", ""]
  keep_separator: true
  is_separator_regex: false
  length_function: "character"

output_path: "./output/knowledgebase-quickb.json"

generate_questions: true
question_output_path: "./output/train_data.json"
deduplication:
  enabled: true
  similarity_threshold: 0.85

hub_username: "AdamLucek"
hub_token: null  # Will use HF_TOKEN env var
hub_private: false
push_to_hub: true

train_embedding: true
training:
  model_id: "nomic-ai/modernbert-embed-base"
  output_dir: "./output/modernbert_mtl"
  epochs: 4
  learning_rate: 2.0e-5
  matryoshka_dimensions: [768, 512, 256, 128, 64]
  batch_size: 32
  gradient_accumulation_steps: 16
  metric_for_best_model: "eval_dim_128_cosine_ndcg@10"
  push_to_hub: true
  hub_model_id: "AdamLucek/modernbert-embed-quickb"